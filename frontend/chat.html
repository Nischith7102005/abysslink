<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AbyssLink Chat</title>
</head>
<body>
<h1>AbyssLink</h1>

<div>
  <input id="msg" placeholder="Type messageâ€¦">
  <button id="send">Send</button>
</div>

<div id="chat"></div>

<h2>Upload File</h2>
<input type="file" id="fileInput">
<button id="up">Upload</button>

<h2>Files</h2>
<ul id="fileList"></ul>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
const roomId = new URL(location.href).searchParams.get("room");
if (!roomId) location.href = "rooms.html";

const socket = io("/", { auth: { roomId } });

socket.on("msg", (m) => {
  const c = document.getElementById("chat");
  c.innerText += "\\n" + m;
});

document.getElementById("send").onclick = () => {
  const v = document.getElementById("msg").value.trim();
  if (v) socket.emit("msg", v);
};

document.getElementById("up").onclick = async () => {
  const f = document.getElementById("fileInput").files[0];
  if (!f) return;

  const form = new FormData();
  form.append("file", f);

  const res = await fetch("/api/upload/" + roomId, {
    method: "POST",
    body: form
  });

  const data = await res.json();
  console.log("Uploaded:", data);
};

socket.emit("requestFiles");
socket.on("files", (files) => {
  const ul = document.getElementById("fileList");
  ul.innerHTML = "";
  files.forEach(f => {
    const li = document.createElement("li");
    li.innerText = f;
    ul.appendChild(li);
  });
});
</script>
</body>
</html>
